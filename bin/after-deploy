#!/usr/bin/env sh

php bin/console cache:clear &&
php bin/console ckeditor:install &&
php bin/console assets:install --symlink &&
php bin/console assetic:dump &&
chmod -R 777 var/ &&
apk add acl &&
HTTPDUSER=$(ps axo user,comm | grep -E '[a]pache|[h]ttpd|[_]www|[w]ww-data|[n]ginx' | grep -v root | head -1 | cut -d\  -f1)
setfacl -dR -m u:"$HTTPDUSER":rwX -m u:$(whoami):rwX var &&
setfacl -R -m u:"$HTTPDUSER":rwX -m u:$(whoami):rwX var &&
cd vendor/jms/translation-bundle/JMS/TranslationBundle/Resources/views &&
ln -s Translate translate &&
cp /cocorico/app/config/parameters_persistant/base.html.twig /cocorico/vendor/jms/translation-bundle/JMS/TranslationBundle/Resources/views/base.html.twig &&
cd /cocorico &&
chmod -R 777 /cocorico/app/Resources/translations &&
/usr/sbin/crond -b -l 8 &&
echo "Done!"